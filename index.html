<link rel="stylesheet" type="text/css" href="style.css">

<script>
	const {ipcRenderer} = require('electron')

	console.log("INIT");

	profiles = [];
	selected = 0;
	loaded = 0;
	runDelay = 0;

	"Basic window functions"
			function win_close(){
				ipcRenderer.send('window-close');
			}
			function win_max() {
				ipcRenderer.send('window-max');
			}
			function win_min() {
				ipcRenderer.send('window-min');
			}
	//-----------------------

	"Backend requests"
		function getProfiles(){
			ipcRenderer.send("get-profiles");
		}
	//-----------------------

	// Profile Data structure:
	// {
  //   "name":"Career",
  //   "version":"1.4.1",
  //   "mods":[
  //     "CKAN",
  //     "Game Data",
  //     "Mechjeb",
  //     "Kerbal engineer redux"
  //   ],
  //   "saves"[
  //     {
  //       "name":"Save 1",
  //       "mode":"CAREER",
  //       "flights":"100",
  //       "funds":"100",
  //       "science":"100",
  //       "reputation":"100"
  //     }
  //   ]
  // }

	ipcRenderer.on("get-profiles", function(e, profiles, loaded){
			console.log(loaded)
			window.loaded = loaded;
			displayProfiles(profiles, loaded, "");
			showProfile(loaded);
	})

	function displayProfiles(profiles, selected, search){
			window.profiles = profiles;
			window.selected = selected;
			var template =
				'<a onclick ="showProfile($ID)">\n\
				\t<div class="$SELECTEDprofile" id="$ID">\n\
				\t\t<h2>$NAME</h2>\n\
				\t\t<p>Version:$VERSION</p>\n\
				\t\t<p>Mods:$MODS Saves:$SAVES</p>\n\
				\t</div>\n\
				</a>\n';
			var out = "";
			for(var i=0; i<profiles.length; i++){
        if(search==""||profiles[i]["name"].toLowerCase().includes(search.toLowerCase())){
          out+=template.replace("$ID", i).replace("$ID", i)
               .replace("$SELECTED", (selected==i)?"selected ":"")
               .replace("$NAME", profiles[i]["name"])
               .replace("$VERSION", profiles[i]["version"])
               .replace("$MODS", profiles[i]["mods"].length)
               .replace("$SAVES", profiles[i]["saves"].length);
        }
			}
		  document.getElementById("results").innerHTML=out;
 		}

		function showProfile(profile){
			document.getElementById(""+selected).className="profile";
			selected = profile;
			document.getElementById(""+profile).className="selected profile";

			document.getElementById("load").className=(selected==loaded?"disabled":"")
			document.getElementById("play").className=(selected!=loaded?"disabled":"")

			console.log(profiles[selected]["mods"])
			document.getElementById("name").innerHTML=profiles[selected]["name"];

			var out = "";
			for(var i = 0; i<profiles[selected]["mods"].length; i++){
				out+="<li>"+profiles[selected]["mods"][i]+"</li>\n";
			}
			document.getElementById("mods").innerHTML=out;

			out = "";
			for(var i = 0; i<profiles[selected]["saves"].length; i++){
				var saves = profiles[selected]["saves"];

				var meta="";
				//Fist line of metadata, mode and flight count
				if(saves[i]["flights"]=="1") var line1 = saves[i]["mode"]+";  "+saves[i]["flights"]+" flight";
				else var line1 = saves[i]["mode"]+";  "+saves[i]["flights"]+" flights";
				//Funds metadata
				var funds = "<span style='color:#2ae21d'>"+saves[i]["funds"]+"</span>; ";
				//Science metadata
				var science = "<span style='color:#1de2d1'>"+saves[i]["science"]+"</span>; ";
				//Reputation metadata
				var rep = "<span style='color:#efe51c'>"+saves[i]["reputation"]+"</span>; ";
				//Sandbox mode, display simple data
				if(saves[i]["mode"]=="SANDBOX") meta = line1
				//Science mode, show science and rep
				if(saves[i]["mode"]=="SCIENCE") meta = line1+"<br/>"+science+rep
				//Career mode, show all data
				if(saves[i]["mode"]=="CAREER") meta = line1+"<br/>"+funds+science+rep
				//Add save to list
				out+="<li style='margin-bottom:15px'><strong style='font-size:20px'>"+saves[i]["name"]+"</strong><br/><div style='padding-left:15px; font-size:15px;'>"+meta+"</div></li>\n"
			}
			document.getElementById("saves").innerHTML=out;

		}

		function search(){
          console.log(document.getElementById("search").value)
          displayProfiles(profiles, selected, document.getElementById("search").value)
		}

		function load(){
			console.log("load")
			loaded = selected;
			ipcRenderer.send("change-profile", selected)
		}

		ipcRenderer.on("load-finished", function(){
			document.getElementById("load").className=(selected==loaded?"disabled":"")
			document.getElementById("play").className=(selected!=loaded?"disabled":"")
		})

		function play(){

		}

		ipcRenderer.send("get-profiles");

</script>

<body>
  <!-- Header bar, contains config button and window buttons -->
  <header>
    <a class="close" id="close" onclick="win_close()">&times;</a>
    <a class="close" id="max" onclick="win_max()">&square;</a>
    <a class="close" id="min" onclick="win_min()">&#95;</a>
  </header>

  <search>
    <input type="text" oninput="search()" id="search"/>
    <results id="results">

    </results>
  </search>
  <content>
    <header>
      <h1 id="name">Career</h1>
      <div style="margin-right:10%">
        <a class="" id="play" onclick="play()">Play</a>
        <a class="" id="load" onclick="load()">Load</a>
      </div>
    </header>

    <div class="flex">
      <article>
        <h1>Mods</h1>
        <ul id="mods">
          <li>CKAN</li>
          <li>Mechjeb</li>
        </ul>
      </article>

      <article style="flex-grow:5">
        <h1>Saves</h1>
        <ul id="saves">
          <li>CKAN</li>
          <li>Mechjeb</li>
        </ul>
      </article>
    </div>


  </content>

<script>

		var profiles = [
		  {
		    "name":"Career",
		    "version":"1.4.1",
		    "mods":[
		      "CKAN",
		      "Game Data",
		      "Mechjeb",
		      "Kerbal engineer redux"
		    ],
		    "saves":[
		      {
		        "name":"Save 1",
		        "mode":"CAREER",
		        "flights":"100",
		        "funds":"100",
		        "science":"100",
		        "reputation":"100"
		      },
		      {
		        "name":"Save 2",
		        "mode":"SANDBOX",
		        "flights":"100",
		        "funds":"100",
		        "science":"100",
		        "reputation":"100"
		      }
		    ]
		  },
		  {
		    "name":"Sanbox",
		    "version":"1.4.1",
		    "mods":[
		      "CKAN",
		      "Game Data",
		      "Mechjeb",
		      "Kerbal engineer redux"
		    ],
		    "saves":[
		      {
		        "name":"Save 1",
		        "mode":"SANDBOX",
		        "flights":"100",
		        "funds":"100",
		        "science":"100",
		        "reputation":"100"
		      }
		    ]
		  },
		  {
		    "name":"Weapons",
		    "version":"1.4.1",
		    "mods":[
		      "CKAN",
		      "Game Data",
		      "Mechjeb",
		      "Kerbal engineer redux"
		    ],
		    "saves":[
		      {
		        "name":"Save 1",
		        "mode":"SCIENCE",
		        "flights":"100",
		        "funds":"100",
		        "science":"100",
		        "reputation":"100"
		      }
		    ]
		  }
		];

		// displayProfiles(profiles, 0, "")
		//
		// showProfile(0);

</script>

</body>
